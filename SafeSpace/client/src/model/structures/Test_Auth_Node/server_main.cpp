#include "auth_server.h"
#include <iostream>
#include <csignal>
#include <cstdlib>

AuthServer* server = nullptr;

void signalHandler(int signal) {
    std::cout << "\n游띔 Recibida se침al de interrupci칩n. Cerrando servidor..." << std::endl;
    if (server) {
        server->stop();
    }
    exit(0);
}

int main(int argc, char* argv[]) {
    int port = 8080;
    
    if (argc >= 2) {
        port = std::atoi(argv[1]);
    }
    
    std::cout << "Iniciando servidor de autenticaci칩n..." << std::endl;
    
    // Manejar se침ales de interrupci칩n
    signal(SIGINT, signalHandler);
    signal(SIGTERM, signalHandler);
    
    AuthServer authServer(port);
    server = &authServer;
    
    if (!authServer.start()) {
        std::cerr << "No se pudo iniciar el servidor" << std::endl;
        return 1;
    }
    
    authServer.run();
    return 0;
}